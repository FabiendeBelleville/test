package persistence;

import static org.junit.jupiter.api.Assertions.*;

import org.junit.jupiter.api.Test;

import exception.MyBusinessException;
import model.Customer;

//CREATE TABLE `customer` (
//  `id` int(11) NOT NULL,
//  `firstname` varchar(250) NOT NULL,
//  `lastname` varchar(250) NOT NULL,
//  `age` mediumint(8) DEFAULT NULL
//) ENGINE=InnoDB DEFAULT CHARSET=latin1;
//
//--
//-- Déchargement des données de la table `customer`
//--
//
//INSERT INTO `customer` (`id`, `firstname`, `lastname`, `age`) VALUES
//(1, 'Bob', 'Bill', 42),
//(2, 'Bill', 'Boule', 3);
//
//--
//-- Index pour les tables déchargées
//--
//
//--
//-- Index pour la table `customer`
//--
//ALTER TABLE `customer`
//  ADD PRIMARY KEY (`id`);
//
//--
//-- AUTO_INCREMENT pour les tables déchargées
//--
//
//--
//-- AUTO_INCREMENT pour la table `customer`
//--
//ALTER TABLE `customer`
//  MODIFY `id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=3;
//COMMIT;

class DaoCustomerTest {

	CustomerDao dao = new CustomerDaoImpl();

	@Test
	void customerPersisted() throws MyBusinessException {
		Customer c = new Customer("Bill", "Boule", 3);

		int result = dao.create(c);
		assertEquals(1, result);
	}

	/**
	 * we suppose an existing customer of id 1 with firstname = Bob
	 */
	@Test
	void customerUpdated() throws MyBusinessException {
		Customer c2 = dao.findById(1);
		assertEquals("Bob", c2.getFirstname());
		c2.setFirstname("newFirstname");
		int r = dao.update(c2);
		assertEquals(1, r);
		assertEquals("newFirstname", c2.getFirstname());
		c2.setFirstname("Bob");
		dao.update(c2);

	}

	/**
	 * we suppose an existing customer of id 3
	 */
	@Test
	void customerId1Found() throws MyBusinessException {
		Customer c = dao.findById(1);
		assertNotNull(c);
		assertTrue("Bob".equals(c.getFirstname()));

	}

	/**
	 * we suppose an existing customer of id 5
	 */
	@Test
	void customerDeleted() throws MyBusinessException {
		Customer c = dao.findById(5);
		int r = dao.delete(c);
		assertEquals(1, r);

	}
}
